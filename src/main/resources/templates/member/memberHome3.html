<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Member Home</title>
</head>

<body>
    <!-- header -->
    <header class="navbar sticky-top flex-md-nowrap">
        <div class="col-md-3 col-lg-3 me-0 px-3 fs-6">
            <a class="navbar-brand" th:href="memberHome"> <i class="bi-box"></i> Mini Finance </a>
        </div>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button"
            data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <form class="custom-form header-form ms-lg-3 ms-md-3 me-lg-auto me-md-auto order-2 order-lg-0 order-md-0"
            action="#" method="get" role="form">
            <input class="form-control" name="search" type="text" placeholder="Search" aria-label="Search">
        </form>
    </header>

    <div class="container-fluid">
        <div class="row">
            <!-- 引入 sidebar -->
            <div th:replace="fragments/sidebar :: sidebar"></div>

            <!-- 主內容 -->
            <main class="main-wrapper col-md-9 ms-sm-auto py-4 col-lg-9 px-md-4 border-start">
                <div class="title-group mb-3">
                    <h1 class="h2 mb-0">Overview</h1>
                    <small class="text-muted">Hello Thomas, welcome back!</small>
                </div>

                <!-- 範例內容區 -->
                <div class="row my-4">
                    <div class="col-12">
                        <p>Main content here...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 右側滑出側欄 -->
    <div id="memberSetting">
        <button class="close-btn">&times;</button>
        <div id="settingContent">
            <!-- AJAX 載入會員設定表單 -->
        </div>
    </div>

    <!-- CSS for sliding sidebar -->
    <style>
        #memberSetting {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background: #fff;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1050;
            overflow: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        #memberSetting.show {
            transform: translateX(0);
        }

        #memberSetting .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
        }
    </style>

    <!-- JavaScript -->
    <script>
        $(document).ready(function () {
            // 點擊 Setting 開啟側欄並載入表單
            $(document).on('click', '#openSetting', function () {
                console.log("Click: openSetting triggered");

                $.get('/member/setting')
                    .done(function (data) {
                        console.log("GET /member/setting response:", data);
                        $('#settingContent').html(data);
                        $('#memberSetting').addClass('show');
                    })
                    .fail(function (xhr, status, error) {
                        console.error("GET failed:", status, error);
                    });
            });

            // 表單 submit 事件，使用事件代理
            $(document).on('submit', '#memberSettingsForm', function (e) {
                e.preventDefault();
                console.log("Form submit triggered", $(this).serialize());

                $.post('/member/setting/update', $(this).serialize())
                    .done(function (resp) {
                        console.log("Update success", resp);
                        alert("Settings updated!");
                        $('#memberSetting').removeClass('show');
                    })
                    .fail(function (err) {
                        console.error("Update failed", err);
                        alert("Update failed");
                    });
            });

            // 關閉側欄
            $('#memberSetting .close-btn').click(function () {
                console.log("Close button clicked");
                $('#memberSetting').removeClass('show');
            });
        });
    </script>
</body>
</html>
